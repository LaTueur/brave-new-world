bnw_destroy_every_higher_tier_title_effect = {
    every_empire = {
		limit = {
			exists = holder
		}
        holder = {
            destroy_title = prev
        }
    }
    every_kingdom = {
		limit = {
			exists = holder
		}
        holder = {
            destroy_title = prev
        }
    }
    every_duchy = {
		limit = {
			exists = holder
		}
        holder = {
            destroy_title = prev
        }
    }
}
bnw_resolve_county_change_effect = {
	create_title_and_vassal_change = {
		type = usurped
		save_scope_as = change
		add_claim_on_loss = no
	}
	change_title_holder_include_vassals = {
		holder = scope:new_count
		change = scope:change
	}
	save_temporary_scope_as = current_county
	if = {
		limit = {
			any_player = {
				capital_province.county = scope:current_county
			}
		}
		every_player = {
			limit = {
				capital_province.county = scope:current_county
			}
			set_player_character = scope:new_count
		}
	}
	resolve_title_and_vassal_change = scope:change
    set_variable = { name = choosen_owner value = yes }
}
bnw_counts_setup_effect = {
    while = {
		limit = {
			any_kingdom = {
				NOT = { exists = var:checked_counties }
			}
		}
		random_kingdom = {
			limit = {
				NOT = { exists = var:checked_counties }
			}
			while = {
				limit = {
					any_in_de_jure_hierarchy = {
						tier = tier_county
						NOT = { exists = var:choosen_owner }
					}
				}
				random_in_de_jure_hierarchy = {
					limit = {
						tier = tier_county
						NOT = { exists = var:choosen_owner }
					}
					save_temporary_scope_as = core_county
					create_character = {
						age = { 6 60 }
						random_traits = yes
						gender_female_chance = 50
						culture = scope:core_county.culture
						faith = scope:core_county.faith
						location = scope:core_county.title_province
						save_scope_as = new_count
					}
					bnw_resolve_county_change_effect = yes
				}
				scope:new_count = {
					set_variable = {
						name = counties_still_wanted
						value = {
							integer_range = {
								min = 0
								max = 5
							}
						}
					}
					while = {
						limit = {
							var:counties_still_wanted >= 1
							any_sub_realm_county = {
								OR = {
									any_neighboring_county = {
										NOT = { exists = var:choosen_owner }
									}
									any_title_to_title_neighboring_and_across_water_county = {
										NOT = { exists = var:choosen_owner }
									}
								}
							}
						}
						if = {
							limit = {
								any_sub_realm_county = {
									any_neighboring_county = {
										NOT = { exists = var:choosen_owner }
									}
								}
							}
							every_sub_realm_county = {
								every_neighboring_county = {
									limit = {
										NOR = {
											is_in_list = counties_to_select_from
											exists = var:choosen_owner
										}
									}
									add_to_list = counties_to_select_from
								}
							}
						}
						else = {
							every_sub_realm_county = {
								every_title_to_title_neighboring_and_across_water_county = {
									limit = {
										NOR = {
											is_in_list = counties_to_select_from
											exists = var:choosen_owner
										}
									}
									add_to_list = counties_to_select_from
								}
							}
						}
						
						random_in_list = {
							list = counties_to_select_from
							weight = {
								base = 10
								modifier = {
									add = 5
									faith = scope:new_count.faith
								}
								modifier = {
									add = 5
									culture = scope:new_count.culture
								}
								modifier = {
									add = 5
									religion = scope:new_count.religion
								}
								modifier = {
									add = 5
									culture_group = scope:new_count.culture_group
								}
							}
							bnw_resolve_county_change_effect = yes
						}
						every_in_list = {
							list = counties_to_select_from
							remove_from_list = counties_to_select_from
						}
						change_variable = { name = counties_still_wanted subtract = 1 }
					}
				}
			}
			set_variable = { name = checked_counties value = yes }
		}
    }
	every_county = {
		remove_variable = choosen_owner
	}
	every_kingdom = {
		remove_variable = checked_counties
	}
}
bnw_higher_realms_setup_effect = {
	if = {
		limit = {
			$TIER$ = tier_duchy
		}
		every_duchy = {
			limit = {
				is_titular = no
			}
			add_to_list = titles_to_handle
		}
	}
	else_if = {
		limit = {
			$TIER$ = tier_kingdom
		}
		every_kingdom = {
			limit = {
				is_titular = no
			}
			add_to_list = titles_to_handle
		}
	}
	else_if = {
		limit = {
			$TIER$ = tier_empire
		}
		every_empire = {
			limit = {
				is_titular = no
			}
			add_to_list = titles_to_handle
		}
	}
	while = {
		limit = {
			any_in_list = {
				list = titles_to_handle
				NOT = {	exists = var:checked_ownership }
			}
		}
		random_in_list = {
			list = titles_to_handle
			limit = {
				NOT = {	exists = var:checked_ownership }
			}
			random = {
				chance = 0
				modifier = {
					add = {
						value = 100
						subtract = $IGNORE_RATE$
					}
				}
				save_temporary_scope_as = title_searching_owner
				ordered_de_jure_top_liege = {
					order_by = bnw_num_of_held_de_jure_counties
					max = 1
					if = {
						limit = {
							bnw_de_jure_held_percentage >= $THRESHOLD$
						}
						save_temporary_scope_as = new_owner
						create_title_and_vassal_change = {
							type = created
							save_scope_as = change
							add_claim_on_loss = no
						}
						scope:title_searching_owner = {
							change_title_holder = {
								holder = scope:new_owner
								change = scope:change
							}
						}
						resolve_title_and_vassal_change = scope:change
						create_title_and_vassal_change = {
							type = swear_fealty
							save_scope_as = change
							add_claim_on_loss = no
						}
						scope:title_searching_owner = {
							every_de_jure_top_liege = {
								limit = {
									NOT = { this = scope:new_owner }
									highest_held_title_tier < scope:title_searching_owner.tier
									bnw_outside_de_jure_percent <= 0.5
								}
								random = {
									chance = $VASSALIZATION_RATE$
									change_liege = {
										liege = scope:new_owner
										change = scope:change
									}
								}
							}
						}
						resolve_title_and_vassal_change = scope:change
					}
				}
			}
			set_variable = { name = checked_ownership value = yes }
		}
		
	}
	every_in_list = {
		list = titles_to_handle
		remove_variable = checked_ownership
		remove_from_list = titles_to_handle
	}
}